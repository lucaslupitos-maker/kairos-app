{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - {{ barbearia.nome|default:"Homem.com Agenda" }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --green: #18c90f;
      --green-soft: rgba(24,201,15,.12);
      --text: #1f2937;
      --muted: #6b7280;
      --bg: #f5f6f8;
      --card: #ffffff;
      --stroke: rgba(31,41,55,.10);
      --danger-soft: rgba(220,53,69,.10);
      --danger: #dc3545;
      --warning-soft: rgba(255,193,7,.18);
      --warning: #b58100;
    }

    body{
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    /* Topbar igual do hor√°rios */
    .topbar{
      background: linear-gradient(180deg, #ffffff, #f7f8fa);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 14px 14px;
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
    }

    .hint{ color: var(--muted); font-size: .85rem; }

    .btn-green{
      background: var(--green);
      border-color: var(--green);
      color: #fff;
      border-radius: 999px;
      font-weight: 700;
      padding: .55rem 1rem;
      box-shadow: 0 10px 22px rgba(24,201,15,.20);
    }
    .btn-green:hover{
      background: #14b10c;
      border-color: #14b10c;
      color: #fff;
    }

    .btn-pill{
      border-radius: 999px;
      font-weight: 650;
      padding: .55rem 1rem;
    }

    .btn-outline-green{
      color: var(--green);
      border-color: rgba(24,201,15,.55);
      border-radius: 999px;
      font-weight: 650;
      padding: .55rem 1rem;
    }
    .btn-outline-green:hover{
      background: var(--green);
      color: #fff;
      border-color: var(--green);
    }

    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 16px !important;
      box-shadow: 0 10px 26px rgba(0,0,0,.06);
    }

    .badge-soft{
      background: var(--green-soft);
      color: #0b6b08;
      border: 1px solid rgba(24,201,15,.25);
      border-radius: 999px;
      padding: .18rem .55rem;
      font-size: .75rem;
      font-weight: 700;
    }

    .badge-danger-soft{
      background: var(--danger-soft);
      color: #a11827;
      border: 1px solid rgba(220,53,69,.25);
      border-radius: 999px;
      padding: .18rem .55rem;
      font-size: .75rem;
      font-weight: 700;
    }

    .badge-warning-soft{
      background: var(--warning-soft);
      color: var(--warning);
      border: 1px solid rgba(255,193,7,.35);
      border-radius: 999px;
      padding: .18rem .55rem;
      font-size: .75rem;
      font-weight: 700;
    }

    .stat{
      border: 1px solid rgba(24,201,15,.18);
      background: #fff;
      border-radius: 14px;
      padding: .75rem .7rem;
      text-align: center;
    }
    .stat .v{
      font-size: 1.15rem;
      font-weight: 800;
      letter-spacing: .01em;
    }
    .stat .l{
      font-size: .72rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .08em;
      margin-top: .15rem;
    }

    .appointment-row{
      border: 1px solid rgba(24,201,15,.16);
      background: #fff;
      border-radius: 14px;
      padding: .75rem .8rem;
    }

    .time-pill{
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      padding: .25rem .6rem;
      border-radius: 999px;
      border: 1px solid rgba(24,201,15,.28);
      background: var(--green-soft);
      font-weight: 800;
      letter-spacing: .02em;
    }

    .muted{ color: var(--muted); }

    .kpi{
      border: 1px solid rgba(31,41,55,.08);
      border-radius: 14px;
      padding: .75rem .7rem;
      background: #fff;
      text-align: center;
    }
    .kpi .label{
      font-size: .78rem;
      color: var(--muted);
    }
    .kpi .value{
      font-size: 1rem;
      font-weight: 800;
      margin-top: .15rem;
    }

    .btn-outline-secondary, .btn-outline-danger{
      border-radius: 999px;
      padding: .35rem .8rem;
      font-weight: 650;
    }
  </style>
</head>

<body>
<main class="container py-3" style="max-width: 520px;">

  <!-- TOPBAR -->
  <div class="topbar mb-3 d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center gap-2">
      <img src="{% static 'agenda/img/logo-homemcom.png' %}" alt="Homem.com" style="width:38px;height:38px;border-radius:12px;object-fit:cover;box-shadow:0 8px 18px rgba(0,0,0,.12);background:#fff;">
      <div>
        <h5 class="mb-0">Dashboard</h5>
        <div class="hint">
          {{ barbearia.nome|default:"Homem.com" }} ‚Ä¢ {{ data_hoje|date:"l, d/m" }}
        </div>
      </div>
    </div>

    <a class="btn btn-green btn-sm" href="{% url 'homemcom_novo_agendamento' %}">+ Novo</a>
  </div>

  <!-- HOJE -->
  <section class="mb-3">
    <div class="card">
      <div class="card-body">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>Hoje</strong>
          <span class="badge-soft">Resumo</span>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-4">
            <div class="stat">
              <div class="v">{{ total_atendimentos_hoje|default:"0" }}</div>
              <div class="l">Clientes</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stat">
              <div class="v">R$ {{ total_valor_hoje|default:"0,00" }}</div>
              <div class="l">Total</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stat">
              <div class="v">R$ {{ ticket_medio_hoje|default:"0,00" }}</div>
              <div class="l">Ticket</div>
            </div>
          </div>
        </div>

        {% if agendamentos_hoje %}
          <div class="d-flex flex-column gap-2">
            {% for ag in agendamentos_hoje %}
              <div class="appointment-row">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <div class="time-pill">
                      {{ ag.inicio|date:"H:i" }}
                    </div>
                    <div class="mt-2 fw-semibold">
                      {{ ag.cliente.nome|default:"Cliente" }}
                    </div>
                    <div class="small muted">
                      {{ ag.servico.nome }} ‚Ä¢ {{ ag.servico.duracao_minutos }} min
                      {% if ag.criado_via == "cliente_link" %} ‚Ä¢ via link{% elif ag.criado_via == "whatsapp" %} ‚Ä¢ WhatsApp{% endif %}
                    </div>
                  </div>

                  <div class="text-end">
                    <div class="fw-bold">R$ {{ ag.valor_no_momento }}</div>
                    <div class="mt-1">
                      {% if ag.status == "confirmado" %}
                        <span class="badge-soft">Confirmado</span>
                      {% elif ag.status == "aguardando" %}
                        <span class="badge-warning-soft">Aguardando</span>
                      {% else %}
                        <span class="badge-danger-soft">Cancelado</span>
                      {% endif %}
                    </div>
                  </div>
                </div>

                {% if ag.status != "cancelado" %}
                  <div class="d-flex justify-content-end gap-2 mt-2">
                    <a class="btn btn-outline-secondary btn-sm" href="{% url 'homemcom_remarcar_agendamento' ag.id %}">Remarcar</a>
                    <a class="btn btn-outline-danger btn-sm" href="{% url 'homemcom_cancelar_agendamento' ag.id %}">Cancelar</a>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">Nenhum hor√°rio marcado para hoje.</p>
        {% endif %}

      </div>
    </div>
  </section>

  <!-- RESUMO FINANCEIRO -->
  <section class="mb-3">
    <div class="card">
      <div class="card-body">

        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>Resumo financeiro</strong>
          <span class="badge-soft">KPIs</span>
        </div>

        <div class="row g-2 mb-3">
          <div class="col-4">
            <div class="kpi">
              <div class="label">Servi√ßos hoje</div>
              <div class="value">R$ {{ total_servicos_hoje|default:"0,00" }}</div>
            </div>
          </div>
          <div class="col-4">
            <div class="kpi">
              <div class="label">Produtos hoje</div>
              <div class="value" style="color:#0b6b08;">R$ {{ total_produtos_hoje|default:"0,00" }}</div>
            </div>
          </div>
          <div class="col-4">
            <div class="kpi">
              <div class="label">Total hoje</div>
              <div class="value">R$ {{ total_valor_hoje|default:"0,00" }}</div>
            </div>
          </div>
        </div>

        <div class="row g-2">
          <div class="col-4">
            <div class="kpi">
              <div class="label">Semana</div>
              <div class="value">R$ {{ total_valor_semana|default:"0,00" }}</div>
            </div>
          </div>
          <div class="col-4">
            <div class="kpi">
              <div class="label">M√™s</div>
              <div class="value">R$ {{ total_valor_mes|default:"0,00" }}</div>
            </div>
          </div>
          <div class="col-4">
            <div class="kpi">
              <div class="label">Cancelados</div>
              <div class="value" style="color:#a11827;">R$ {{ total_cancelado_hoje|default:"0,00" }}</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- A√á√ïES -->
  <section>
    <div class="d-grid gap-2">
      <a href="{% url 'homemcom_novo_agendamento' %}" class="btn btn-green btn-pill">
        ‚ûï Novo agendamento
      </a>

      <a href="{% url 'homemcom_semana' %}" class="btn btn-outline-secondary btn-pill">
        üìÖ Ver semana
      </a>

      <a href="{% url 'homemcom_venda_produto' %}" class="btn btn-outline-secondary btn-pill">
        üß¥ Registrar venda de produto
      </a>

      <a href="{% url 'homemcom_horarios' %}" class="btn btn-outline-secondary btn-pill">
        ‚è±Ô∏è Hor√°rios de atendimento
      </a>

      <a href="{% url 'homemcom_configuracoes' %}" class="btn btn-outline-secondary btn-pill">
        ‚öôÔ∏è Servi√ßos e produtos

      <a href="{% url 'homemcom_relatorios' %}" class="btn btn-outline-secondary btn-pill">
        üìä Relat√≥rios
      </a>
    </div>
  </section>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>