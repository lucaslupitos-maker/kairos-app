{% extends "agenda/base.html" %}
{% load static %}

{% block title %}Kair√≥s.app | Novo agendamento{% endblock %}

{% block content %}

<!-- TOPBAR -->
<div class="topbar mb-4 d-flex justify-content-between align-items-center">
  <div>
    <h4 class="mb-1 fw-bold">Novo agendamento</h4>
    <div class="hint">
      Preencha cliente, servi√ßo e hor√°rio ‚Ä¢ o sistema calcula o fim automaticamente
    </div>
  </div>

  <div class="d-flex gap-2 align-items-center">
    <span class="badge-soft">üóìÔ∏è Kair√≥s.app</span>
    <span class="badge-soft">üìå Gestor</span>
  </div>
</div>

<section class="mb-4">
  <div class="card ap-card ap-animate-in">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h6 class="mb-0 fw-bold">Dados do agendamento</h6>
          <small class="text-muted">Cria√ß√£o r√°pida pelo painel</small>
        </div>
       
      </div>

      <form method="post" class="ap-form" novalidate>
        {% csrf_token %}

        <!-- ERROS GERAIS -->
        {% if form.non_field_errors %}
          <div class="alert alert-danger">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div class="row g-3">

          <!-- CLIENTE (digit√°vel) -->
          <div class="col-12">
            <label class="form-label fw-semibold">Cliente</label>

            {# Se voc√™ quiser sugest√£o de clientes, deixe um <datalist> #}
            <input
              type="text"
              name="cliente_nome"
              class="form-control ap-input {% if form.cliente_nome.errors %}is-invalid{% endif %}"
              placeholder="Digite o nome do cliente"
              value="{{ form.cliente_nome.value|default:'' }}"
              autocomplete="off"
              list="clientesSugestoes"
            >

            <datalist id="clientesSugestoes">
              {# opcional: se voc√™ mandar clients no context, isso vira autocomplete nativo #}
              {% if clients %}
                {% for c in clients %}
                  <option value="{{ c.nome }}"></option>
                {% endfor %}
              {% endif %}
            </datalist>

            {% if form.cliente_nome.errors %}
              <div class="invalid-feedback d-block">
                {{ form.cliente_nome.errors|striptags }}
              </div>
            {% endif %}

            <small class="text-muted">
              Se n√£o existir, a gente cria automaticamente. üòé
            </small>
          </div>

          <!-- SERVI√áO -->
          <div class="col-12 col-md-6">
            <label class="form-label fw-semibold">Servi√ßo</label>
            {{ form.servico }}
            {% if form.servico.errors %}
              <div class="invalid-feedback d-block">
                {{ form.servico.errors|striptags }}
              </div>
            {% endif %}
          </div>

          <!-- STATUS -->
          <div class="col-12 col-md-6">
            <label class="form-label fw-semibold">Status</label>
            {{ form.status }}
            {% if form.status.errors %}
              <div class="invalid-feedback d-block">
                {{ form.status.errors|striptags }}
              </div>
            {% endif %}
          </div>

          <!-- DATA E HOR√ÅRIO -->
          <div class="col-12">
            <label class="form-label fw-semibold">Data e hor√°rio (in√≠cio)</label>

            {# Importante: input datetime-local pra ficar amig√°vel #}
            <input
              type="datetime-local"
              name="inicio"
              class="form-control ap-input {% if form.inicio.errors %}is-invalid{% endif %}"
              value="{% if form.inicio.value %}{{ form.inicio.value }}{% endif %}"
            >

            {% if form.inicio.errors %}
              <div class="invalid-feedback d-block">
                {{ form.inicio.errors|striptags }}
              </div>
            {% endif %}

            <small class="text-muted">
              Escolha o in√≠cio. O sistema calcula o fim automaticamente.
            </small>
          </div>

        </div>

        <button class="btn ka-btn-primary btn-lg w-100 ap-btn-glow mt-3" type="submit">
          Salvar agendamento ‚Üí
        </button>

        <div class="mt-3 ap-note">
          <small class="text-muted">üí° Dica: se quiser agilizar, deixe o status como ‚Äúconfirmado‚Äù e pronto.</small>
        </div>

      </form>
    </div>
  </div>
</section>

<script>
  // deixa os selects com a cara do seu tema (caso o form esteja vindo cru)
  (function(){
    const selects = document.querySelectorAll("select");
    selects.forEach(s => s.classList.add("form-select","ap-input"));
  })();
</script>

{% endblock %}