{% extends "agenda/base.html" %}
{% load static %}

{% block title %}Kair√≥s.app | Confirmar agendamento{% endblock %}

{% block content %}

<!-- TOPBAR -->
<div class="topbar mb-4 d-flex justify-content-between align-items-center">
  <div>
    <h4 class="mb-1 fw-bold">Confirmar agendamento</h4>
    <div class="hint">
      {{ barbearia.nome }} ‚Ä¢ etapa final ‚ú®
    </div>
  </div>
  <span class="badge-soft">üë§ Cliente</span>
</div>

<!-- RESUMO DO AGENDAMENTO -->
<section class="mb-4" id="confirmWrap">
  <div class="card ap-card ap-animate-in">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-0 fw-bold">Resumo</h5>
          <small class="text-muted">Confira antes de confirmar</small>
        </div>
        <span class="badge-soft">Kair√≥s.app</span>
      </div>

      <div class="ap-summary">
        <div class="ap-summary-row">
          <div class="ap-summary-label">Servi√ßo</div>
          <div class="ap-summary-value">{{ servico.nome }}</div>
        </div>

        <div class="ap-summary-row">
          <div class="ap-summary-label">Dia</div>
          <div class="ap-summary-value">{{ inicio|date:"d/m/Y" }}</div>
        </div>

        <div class="ap-summary-row">
          <div class="ap-summary-label">Hor√°rio</div>
          <div class="ap-summary-value">‚è∞ {{ inicio|date:"H:i" }}</div>
        </div>
      </div>

      <div class="mt-3 ap-note">
        <small class="text-muted">
          ‚úÖ Enviaremos a confirma√ß√£o para o profissional. Se tiver WhatsApp, melhor ainda üòâ
        </small>
      </div>
    </div>
  </div>
</section>

<!-- FORM DADOS DO CLIENTE -->
<section class="mb-4">
  <div class="card ap-card ap-animate-in">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-0 fw-bold">3) Seus dados</h5>
          <small class="text-muted">S√≥ pra identificar o cliente</small>
        </div>
        <span class="badge-soft">Final</span>
      </div>

      <form method="post" id="confirmForm" class="ap-form">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger rounded-4 mb-3">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div class="mb-3">
          <label class="form-label fw-semibold">Nome</label>
          {{ form.nome }}
          {% if form.nome.errors %}
            <div class="text-danger small mt-1">{{ form.nome.errors }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">WhatsApp (opcional)</label>
          {{ form.telefone }}
          {% if form.telefone.errors %}
            <div class="text-danger small mt-1">{{ form.telefone.errors }}</div>
          {% endif %}
          <div class="form-text">Pode ser s√≥ DDD + n√∫mero. Ex.: 19999999999</div>
        </div>

        <button type="submit" class="btn ka-btn ka-btn-primary w-100 mt-3">
          ‚úÖ Confirmar agendamento
        </button>
      </form>

      <div class="mt-3 d-flex justify-content-between align-items-center">
        <a href="{% url 'public_escolher_servico' barbearia.slug %}" class="ap-link">
          ‚Üê Recome√ßar
        </a>
        <span class="text-muted small">Etapa 3 de 3</span>
      </div>

    </div>
  </div>
</section>

<!-- SKELETON (APARECE AO ENVIAR) -->
<section id="skeletonConfirm" class="mb-4 d-none">
  <div class="card ap-card ap-skeleton">
    <div class="card-body">
      <div class="ap-skel-line w-50 mb-3"></div>
      <div class="ap-skel-line w-100 mb-2"></div>
      <div class="ap-skel-line w-75 mb-4"></div>
      <div class="ap-skel-line w-100 mb-2"></div>
      <div class="ap-skel-line w-60 mb-4"></div>
      <div class="ap-skel-btn"></div>
    </div>
  </div>
</section>

<script>
  // Skeleton ao enviar (fica com cara de app de banco kkk)
  (function(){
    const form = document.getElementById("confirmForm");
    const skel = document.getElementById("skeletonConfirm");
    const wrap = document.getElementById("confirmWrap");
    if(!form || !skel) return;

    form.addEventListener("submit", () => {
      skel.classList.remove("d-none");
      (wrap || skel).scrollIntoView({behavior:"smooth", block:"start"});
    });
  })();
</script>

<script>
  // For√ßa inputs do Django com estilo do tema
  (function(){
    document.querySelectorAll(".ap-form input, .ap-form select, .ap-form textarea").forEach(el=>{
      el.classList.add("ap-input");
      if(el.tagName === "INPUT") el.classList.add("form-control");
    });
  })();
</script>

<style>
  /* Resumo em grid bonit√£o */
  .ap-summary{
    border: 1px solid var(--border-soft);
    border-radius: 18px;
    padding: 12px;
    background: rgba(255,255,255,.55);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  [data-theme="dark"] .ap-summary{
    background: rgba(255,255,255,.05);
  }

  .ap-summary-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    padding: 10px 10px;
    border-radius: 14px;
  }
  .ap-summary-row + .ap-summary-row{
    border-top: 1px solid var(--border-soft);
    border-top-left-radius: 0;
    border-top-right-radius: 0;
  }
  .ap-summary-label{
    color: var(--muted);
    font-size: .85rem;
    font-weight: 600;
  }
  .ap-summary-value{
    font-weight: 800;
    letter-spacing: .01em;
    color: var(--text);
  }

  /* Ajuste extra para garantir leitura no dark */
  [data-theme="dark"] .text-muted,
  [data-theme="dark"] .form-text{
    color: rgba(255,255,255,.68) !important;
  }
  [data-theme="dark"] .form-label{
    color: rgba(255,255,255,.92) !important;
  }
</style>

{% endblock %}