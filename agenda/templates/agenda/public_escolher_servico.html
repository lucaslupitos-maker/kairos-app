{% extends "agenda/base.html" %}
{% load static %}

{% block title %}Kair√≥s.app | Agendar{% endblock %}

{% block content %}

<!-- TOPBAR -->
<div class="topbar mb-4 d-flex justify-content-between align-items-center">
  <div>
    <h4 class="mb-1 fw-bold">Agendar hor√°rio</h4>
    <div class="hint">
      Escolha o servi√ßo e o dia
    </div>
  </div>
  <span class="badge-soft">üë§ Cliente</span>
</div>

<!-- CARD PRINCIPAL -->
<section class="mb-4">
  <div class="card ap-card ap-animate-in">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-0 fw-bold">1) Servi√ßo e dia</h5>
          <small class="text-muted">Depois voc√™ escolhe um hor√°rio dispon√≠vel</small>
        </div>
      </div>

      <form method="post" class="ap-form" id="publicForm">
        {% csrf_token %}

        {% if form.non_field_errors %}
          <div class="alert alert-danger rounded-4 mb-3">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <!-- Servi√ßo -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Servi√ßo</label>
          {{ form.servico }}
          {% if form.servico.errors %}
            <div class="text-danger small mt-1">{{ form.servico.errors }}</div>
          {% endif %}
        </div>

        <!-- Dia -->
        <div class="mb-3">
          <label class="form-label fw-semibold">Dia</label>
          {{ form.data }}
          {% if form.data.errors %}
            <div class="text-danger small mt-1">{{ form.data.errors }}</div>
          {% endif %}
          <div class="form-text">Escolha o dia e clique em ‚ÄúVer hor√°rios‚Äù.</div>
        </div>

        <button class="btn ka-btn ka-btn-primary w-100 mt-3" type="submit">
          Ver hor√°rios dispon√≠veis ‚Üí
        </button>
      </form>

      <div class="mt-3 ap-note">
        <small class="btn ghost">
          ‚úÖ Sem cadastro. Voc√™ confirma seus dados no final.
        </small>
      </div>

    </div>
  </div>
</section>

<!-- SKELETON (APARECE AO ENVIAR) -->
<section id="skeletonPublic" class="mb-4 d-none">
  <div class="card ap-card ap-skeleton">
    <div class="card-body">
      <div class="ap-skel-line w-50 mb-3"></div>
      <div class="ap-skel-line w-100 mb-2"></div>
      <div class="ap-skel-line w-100 mb-2"></div>
      <div class="ap-skel-line w-75 mb-4"></div>
      <div class="ap-skel-btn"></div>
    </div>
  </div>
</section>

<script>
  // Skeleton ao enviar (fica bonito e evita a sensa√ß√£o de ‚Äútravou‚Äù)
  (function(){
    const form = document.getElementById("publicForm");
    const skel = document.getElementById("skeletonPublic");
    if(!form || !skel) return;

    form.addEventListener("submit", () => {
      skel.classList.remove("d-none");
      skel.scrollIntoView({behavior:"smooth", block:"start"});
    });
  })();
</script>

<script>
  // Deixa os inputs do Django Form com a classe do tema (se vierem "crus")
  (function(){
    document.querySelectorAll(".ap-form select, .ap-form input").forEach(el=>{
      el.classList.add("ap-input");
      if(el.tagName === "SELECT") el.classList.add("form-select");
      if(el.tagName === "INPUT") el.classList.add("form-control");
    });
  })();
</script>

{% endblock %}