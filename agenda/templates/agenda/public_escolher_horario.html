{% extends "agenda/base.html" %}
{% load static %}

{% block title %}Kair√≥s.app | Escolher hor√°rio{% endblock %}

{% block content %}

<!-- TOPBAR -->
<div class="topbar mb-4 d-flex justify-content-between align-items-center">
  <div>
    <h4 class="mb-1 fw-bold">Agendar hor√°rio</h4>
    <div class="hint">
      {{ barbearia.nome }} ‚Ä¢ {{ servico.nome }} em {{ data|date:"d/m" }}
    </div>
  </div>
  <span class="badge-soft">üë§ Cliente</span>
</div>

<!-- CARD PRINCIPAL -->
<section class="mb-4" id="cardHorarios">
  <div class="card ap-card ap-animate-in">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h5 class="mb-0 fw-bold">2) Escolha o hor√°rio</h5>
          <small class="text-muted">Toque em um hor√°rio para continuar</small>
        </div>
        <span class="badge-soft">Kair√≥s.app</span>
      </div>

      {% if horarios %}
        <div class="row g-2">
          {% for h in horarios %}
            <div class="col-6 col-md-4">
              <a
                href="{% url 'public_confirmar_dados' barbearia.slug %}?servico={{ servico.id }}&inicio={{ h|date:'Y-m-d\\TH:i' }}"
                class="btn ap-time w-100"
                data-ap-loading="1"
              >
                ‚è∞ {{ h|date:"H:i" }}
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="ap-empty text-center py-4">
          <div class="mb-2" style="font-size: 28px;">üòï</div>
          <div class="fw-bold">Sem hor√°rios dispon√≠veis</div>
          <div class="text-muted small">Tente outro dia ou servi√ßo.</div>
        </div>
      {% endif %}

      <div class="mt-4 d-flex justify-content-between align-items-center">
        <a href="{% url 'public_escolher_servico' barbearia.slug %}" class="ap-link">
          ‚Üê Escolher outro servi√ßo ou dia
        </a>

        {% if horarios %}
          <span class="text-muted small">Etapa 2 de 3</span>
        {% endif %}
      </div>

    </div>
  </div>
</section>

<!-- SKELETON (aparece ao clicar em um hor√°rio) -->
<section id="skeletonHorarios" class="mb-4 d-none">
  <div class="card ap-card ap-skeleton">
    <div class="card-body">
      <div class="ap-skel-line w-50 mb-3"></div>
      <div class="ap-skel-line w-75 mb-2"></div>
      <div class="ap-skel-line w-100 mb-4"></div>

      <div class="row g-2">
        <div class="col-6"><div class="ap-skel-chip"></div></div>
        <div class="col-6"><div class="ap-skel-chip"></div></div>
        <div class="col-6"><div class="ap-skel-chip"></div></div>
        <div class="col-6"><div class="ap-skel-chip"></div></div>
        <div class="col-6"><div class="ap-skel-chip"></div></div>
        <div class="col-6"><div class="ap-skel-chip"></div></div>
      </div>
    </div>
  </div>
</section>

<script>
  // Skeleton ao clicar em um hor√°rio (pra parecer app de empresa rica)
  (function () {
    const skel = document.getElementById("skeletonHorarios");
    const card = document.getElementById("cardHorarios");
    if (!skel || !card) return;

    document.querySelectorAll("[data-ap-loading='1']").forEach(btn => {
      btn.addEventListener("click", () => {
        skel.classList.remove("d-none");
        skel.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });
  })();
</script>

<style>
  /* Chips de hor√°rio com cara de SaaS */
  .ap-time{
    border-radius: 16px;
    border: 1px solid var(--border-soft);
    background: rgba(255,255,255,.65);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 14px 12px;
    font-weight: 700;
    transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    color: var(--text);
    text-decoration: none;
  }
  .ap-time:hover{
    transform: translateY(-1px);
    box-shadow: 0 12px 30px rgba(0,0,0,.08);
    border-color: rgba(99,102,241,.35);
  }
  [data-theme="dark"] .ap-time{
    background: rgba(255,255,255,.06);
    color: var(--text);
  }

  .ap-empty{
    border: 1px dashed var(--border-soft);
    border-radius: 18px;
    background: rgba(255,255,255,.45);
  }
  [data-theme="dark"] .ap-empty{
    background: rgba(255,255,255,.05);
  }

  /* Skeleton chip */
  .ap-skel-chip{
    height: 46px;
    border-radius: 16px;
    background: linear-gradient(
      90deg,
      rgba(150,150,150,.10) 0%,
      rgba(150,150,150,.22) 40%,
      rgba(150,150,150,.10) 80%
    );
    background-size: 200% 100%;
    animation: apShimmer 1.2s infinite linear;
    border: 1px solid var(--border-soft);
  }
  @keyframes apShimmer{
    0%{ background-position: 200% 0; }
    100%{ background-position: -200% 0; }
  }
</style>

{% endblock %}